<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ–°å¹´çƒŸèŠ± ğŸ‡</title>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.4.0/dist/pixi.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      overflow: hidden;
      background: #000;
      color: #fff;
      font-family: 'Russo One', Arial, sans-serif;
      touch-action: none;
    }
    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #stage-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
    }
    #loading-init {
      position: absolute;
      z-index: 10;
      font-size: clamp(1.5rem, 5vmax, 3rem);
      text-align: center;
      pointer-events: none;
    }
    #instructions {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: clamp(0.8rem, 2.5vmax, 1.2rem);
      opacity: 0.7;
      pointer-events: none;
    }

    /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    @media (max-width: 768px) {
      #stage-container {
        border: none;
        margin: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading-init">åŠ è½½ä¸­â€¦</div>
    <div id="stage-container"></div>
    <div id="instructions">ç‚¹å‡»æˆ–è§¦æ‘¸å±å¹•å‘å°„çƒŸèŠ±</div>
  </div>

  <script>
    const IS_MOBILE = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const IS_DESKTOP = !IS_MOBILE;
    const MAX_WIDTH = 1920;
    const MAX_HEIGHT = 1080;

    let app, mainStage;
    let isFullscreen = false;

    // å…¨å±è¯·æ±‚ï¼ˆå®‰å…¨å°è£…ï¼‰
    function requestFullscreen() {
      if (isFullscreen) return;
      const elem = document.documentElement;
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
      }
      isFullscreen = true;
    }

    // è‡ªå®šä¹‰çƒŸèŠ±ç²’å­ç±»
    class FireworkParticle extends PIXI.Sprite {
      constructor(x, y, color) {
        const graphics = new PIXI.Graphics();
        graphics.beginFill(color);
        graphics.drawCircle(0, 0, 2);
        graphics.endFill();
        const texture = app.renderer.generateTexture(graphics);
        super(texture);
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 8;
        this.vy = (Math.random() - 0.5) * 8 - 6;
        this.alpha = 1;
        this.life = 100;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.05; // é‡åŠ›
        this.life--;
        this.alpha = this.life / 100;
      }

      isDead() {
        return this.life <= 0 || this.alpha <= 0;
      }
    }

    // å‘å°„çƒŸèŠ±
    function launchFirework(x, y) {
      const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff, 0x00ffff];
      const color = colors[Math.floor(Math.random() * colors.length)];
      const particles = [];
      for (let i = 0; i < 100; i++) {
        particles.push(new FireworkParticle(x, y, color));
      }
      particles.forEach(p => mainStage.addChild(p));
      return particles;
    }

    // è‡ªåŠ¨å‘å°„ï¼ˆå¯é€‰ï¼‰
    function autoLaunch() {
      if (!mainStage) return;
      const x = Math.random() * app.screen.width;
      const y = app.screen.height * 0.8;
      launchFirework(x, y);
      setTimeout(autoLaunch, 1000 + Math.random() * 2000);
    }

    // ä¸»å¾ªç¯
    function animate() {
      if (!mainStage) return;
      for (let i = mainStage.children.length - 1; i >= 0; i--) {
        const child = mainStage.children[i];
        if (child instanceof FireworkParticle) {
          child.update();
          if (child.isDead()) {
            child.destroy();
            mainStage.removeChild(child);
          }
        }
      }
      requestAnimationFrame(animate);
    }

    // åˆå§‹åŒ– Pixi åº”ç”¨
    function initApp() {
      const container = document.getElementById('stage-container');

      // å°ºå¯¸é€‚é…
      const resize = () => {
        const w = Math.min(window.innerWidth, MAX_WIDTH);
        const h = Math.min(window.innerHeight, MAX_HEIGHT);
        app.renderer.resize(w, h);
        app.screen.width = w;
        app.screen.height = h;
        mainStage.scale.set(w / MAX_WIDTH, h / MAX_HEIGHT);
      };

      app = new PIXI.Application({
        width: Math.min(window.innerWidth, MAX_WIDTH),
        height: Math.min(window.innerHeight, MAX_HEIGHT),
        backgroundColor: 0x000000,
        antialias: true,
        resizeTo: window,
        view: document.createElement('canvas')
      });

      mainStage = new PIXI.Container();
      mainStage.interactive = true;
      mainStage.scale.set(app.screen.width / MAX_WIDTH, app.screen.height / MAX_HEIGHT);
      app.stage.addChild(mainStage);
      container.appendChild(app.view);

      // ç‚¹å‡»/è§¦æ§å‘å°„
      const handleClick = (event) => {
        let x, y;
        if (event.touches) {
          x = event.touches[0].clientX;
          y = event.touches[0].clientY;
        } else {
          x = event.clientX;
          y = event.clientY;
        }
        // è½¬æ¢ä¸ºèˆå°åæ ‡
        const point = mainStage.toLocal(new PIXI.Point(x, y), null);
        launchFirework(point.x, point.y);
        if (!IS_DESKTOP && !isFullscreen) {
          requestFullscreen();
        }
      };

      mainStage.on('pointerdown', handleClick);
      mainStage.on('touchstart', handleClick);

      window.addEventListener('resize', resize);
      resize();

      document.getElementById('loading-init').style.display = 'none';

      animate();
      if (IS_DESKTOP) autoLaunch(); // æ¡Œé¢è‡ªåŠ¨æ”¾ï¼Œç§»åŠ¨ç«¯æ‰‹åŠ¨ç‚¹
    }

    // å¯åŠ¨
    window.addEventListener('load', () => {
      // æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼ˆéšè—ç§»åŠ¨ç«¯æµè§ˆå™¨åœ°å€æ ï¼‰
      window.scrollTo(0, 0);
      initApp();
    });
  </script>
</body>
</html>
